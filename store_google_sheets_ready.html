<!DOCTYPE html>

<html lang="ar">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>متجر إلكتروني متطور</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&amp;display=swap" rel="stylesheet"/>
<style>
    :root {
      --primary-color: #2A5C82;
      --accent-color: #FF7E67;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Tajawal', Arial, sans-serif;
      direction: rtl;
      background: #f8f9fa;
      overflow-x: hidden;
    }
    /* الشريط العلوي */
    #header {
      background: linear-gradient(135deg, rgba(42,92,130,0.98), rgba(26,70,104,0.98));
      padding: 12px 20px;
      position: sticky;
      top: 0;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: space-between;
      color: #fff;
      transition: transform 0.3s ease;
    }
    #header h1 {
      font-size: 1.8rem;
      font-weight: 700;
      letter-spacing: -0.5px;
    }
    #header button {
      background: rgba(255,255,255,0.1);
      width: 45px;
      height: 45px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      border: none;
      cursor: pointer;
      position: relative;
      transition: all 0.3s ease;
    }
    #header button:hover {
      background: rgba(255,255,255,0.2);
      transform: rotate(10deg);
    }
    .cart-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: var(--accent-color);
      color: #fff;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      font-size: 0.7rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }
    /* الشريط السفلي */
    #bottomNav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(20px);
      border-radius: 20px 20px 0 0;
      margin: 0 10px;
      width: calc(100% - 20px);
      box-shadow: 0 -8px 30px rgba(0,0,0,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      padding: 12px 0;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      z-index: 1000;
    }
    #bottomNav button {
      background: none;
      border: none;
      outline: none;
      cursor: pointer;
      color: var(--primary-color);
      transition: transform 0.2s ease, color 0.2s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      font-size: 0.8rem;
    }
    #bottomNav button:hover {
      transform: scale(1.1);
      color: var(--accent-color);
    }
    #bottomNav button.active {
      color: var(--accent-color);
    }
    #bottomNav button span {
      display: block;
    }
    .nav-icon {
      width: 28px;
      height: 28px;
      fill: var(--primary-color);
      transition: fill 0.2s ease;
    }
    #bottomNav button.active .nav-icon,
    #bottomNav button:hover .nav-icon {
      fill: var(--accent-color);
    }
    /* منطقة المحتوى */
    #mainScreen {
      display: flex;
      height: 100vh;
      flex-direction: column;
      position: relative;
    }
    #content {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
      padding-bottom: 5rem;
    }
    .screen {
      display: none;
    }
    .screen.active {
      display: block;
    }
    /* شاشة المنتجات */
    #searchContainer {
      display: flex;
      justify-content: center;
      margin: 1.5rem 0;
    }
    .search-wrapper {
      position: relative;
      width: 90%;
      max-width: 500px;
    }
    .search-wrapper input {
      width: 100%;
      padding: 12px 16px 12px 20px;
      font-size: 16px;
      border: 2px solid #e0e0e0;
      border-radius: 30px;
      outline: none;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    .search-wrapper input:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 8px rgba(42,92,130,0.2);
    }
    .search-icon {
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      width: 24px;
      height: 24px;
      fill: var(--primary-color);
      opacity: 0.7;
    }
    /* شريط التمرير الأفقي (Slider) لعرض 6 منتجات */
    .horizontal-slider {
      overflow: hidden;
      position: relative;
      margin: 1rem 0;
    }
    .slider {
      display: flex;
      transition: transform 0.3s ease;
    }
    .slider .product-card {
      flex: 0 0 calc(50% - 10px);
      margin: 0 5px;
    }
    .slider-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0,0,0,0.5);
      color: #fff;
      border: none;
      padding: 10px;
      cursor: pointer;
      z-index: 2;
    }
    .slider-btn.left {
      left: 10px;
    }
    .slider-btn.right {
      right: 10px;
    }
    /* شاشة المنتجات (Grid) */
    #productsList {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 2rem;
      justify-items: center;
      padding: 2rem 0;
    }
    .product-card {
      background: #fff;
      border-radius: 12px;
      padding: 0.5rem 1rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      position: relative;
      transition: transform 0.2s ease, box-shadow 0.3s ease;
      width: 100%;
      max-width: 300px;
      cursor: pointer;
    }
    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.1);
    }
    .product-card img {
      width: 100%;
      height: 140px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 0.5rem;
    }
    .product-info {
      margin-top: 0.5rem;
      font-size: 14px;
    }
    .product-info h3 {
      color: #333;
      margin-bottom: 0.5rem;
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .old-price {
      text-decoration: line-through;
      color: #999;
      margin-left: 5px;
      font-size: 12px;
    }
    .new-price {
      color: #2A5C82;
      font-weight: bold;
      font-size: 14px;
    }
    .discount-badge {
      display: inline-block;
      background: #FF7E67;
      color: #fff;
      font-weight: bold;
      padding: 4px 8px;
      border-radius: 20px;
      font-size: 12px;
      margin-left: 0.5rem;
    }
    .favorite-btn {
      top: -12px;
      left: -12px;
      width: 30px;
      height: 30px;
      font-size: 16px;
      padding: 4px;
      background: black;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 5px rgba(0,0,0,0.4);
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 24px;
      background: #000;
      border-radius: 50%;
      padding: 6px;
      border: 2px solid #fff;
      color: #fff;
      text-shadow: none;
      transition: all 0.3s ease;
    }
    .favorite-btn.active {
      color: #FF4757;
      transform: scale(1.1);
    }
    /* شاشة رفع المنتج */
    .upload-form {
      background: #fff;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      max-width: 600px;
      margin: 0 auto;
    }
    .upload-form input,
    .upload-form select,
    .upload-form textarea {
      width: 100%;
      padding: 12px;
      margin-bottom: 1rem;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.3s ease;
    }
    .upload-form input:focus,
    .upload-form select:focus,
    .upload-form textarea:focus {
      border-color: #2A5C82;
      box-shadow: 0 0 8px rgba(42,92,130,0.1);
    }
    .upload-form button {
      padding: 12px;
      width: 100%;
      background: linear-gradient(135deg, #2A5C82, #1A4668);
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      transition: transform 0.2s ease;
    }
    .upload-form button:hover {
      transform: translateY(-2px);
    }
    /* شاشة السلة */
    #cartList {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1.5rem;
      justify-items: center;
      padding: 1.5rem 0;
    }
    .cart-card {
      background: #fff;
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      position: relative;
      width: 100%;
      max-width: 240px;
      cursor: pointer;
    }
    .cart-card img {
      width: 100%;
      height: 140px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 0.5rem;
    }
    .complete-purchase {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #32BEA6, #229C8A);
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 1.5rem;
      font-size: 16px;
      transition: transform 0.2s ease;
    }
    .complete-purchase:hover {
      transform: translateY(-2px);
    }
    /* شاشة المفضلة */
    #favoriteList {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1.5rem;
      justify-items: center;
      padding: 1.5rem 0;
    }
    .favorite-card {
      background: #fff;
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      position: relative;
      width: 100%;
      max-width: 200px;
      cursor: pointer;
    }
    .favorite-card img {
      width: 100%;
      height: 140px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 0.5rem;
    }
    /* نافذة تفاصيل المنتج (Modal) */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background: rgba(0,0,0,0.9);
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background: #fff;
      margin: auto;
      padding: 1.5rem;
      border-radius: 12px;
      width: 95%;
      max-width: 700px;
      position: relative;
    }
    .close {
      position: absolute;
      top: 10px;
      left: 10px;
      color: #fff;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      z-index: 1001;
      background: rgba(0,0,0,0.6);
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .close:hover {
      color: #FF7E67;
    }
    .slider-container {
      position: relative;
      width: 100%;
      max-height: 400px;
      overflow: hidden;
      border-radius: 12px;
      margin-bottom: 1.5rem;
    }
    .slider-images img {
      width: 100%;
      height: 400px;
      object-fit: cover;
      display: none;
      border-radius: 12px;
    }
    .slider-images img.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .slider-arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255,255,255,0.9);
      color: #333;
      border: none;
      cursor: pointer;
      font-size: 24px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }
    .slider-arrow:hover {
      background: #fff;
      transform: translateY(-50%) scale(1.1);
    }
    .slider-arrow.left { left: 1rem; }
    .slider-arrow.right { right: 1rem; }
    .modal-details {
      margin-top: 1rem;
      padding: 0 1rem;
    }
    .modal-details h3 {
      margin-bottom: 1rem;
      color: #2A5C82;
      font-size: 1.5rem;
    }
    .modal-details p {
      margin-bottom: 1rem;
      font-size: 14px;
      color: #555;
      line-height: 1.6;
    }
    .price-row {
      margin: 1rem 0;
      display: flex;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
    }
    .old-price {
      text-decoration: line-through;
      color: #999;
    }
    .new-price {
      color: #2A5C82;
      font-weight: bold;
      font-size: 1.2rem;
    }
    .discount-badge {
      display: inline-block;
      background: #FF7E67;
      color: #fff;
      font-weight: bold;
      padding: 4px 8px;
      border-radius: 20px;
      font-size: 12px;
    }
    .ramadan-offer {
      color: #FF7E67;
      font-weight: bold;
      margin-top: 1rem;
      font-size: 14px;
    }
    .modal-actions {
      margin-top: 1.5rem;
      display: flex;
      gap: 1rem;
    }
    .modal-actions button {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      transition: transform 0.2s ease;
    }
    .modal-actions button:hover { transform: translateY(-2px); }
    .add-to-cart {
      background: linear-gradient(135deg, #2A5C82, #1A4668);
      color: #fff;
    }
    .buy-now {
      background: linear-gradient(135deg, #FF7E67, #FF6B4A);
      color: #fff;
    }
    .delete-product {
      background: none;
      border: none;
      font-size: 36px;
      color: #d63031;
      cursor: pointer;
      margin-top: 1rem;
      display: block;
      margin-left: auto;
      margin-right: auto;
      transition: transform 0.2s ease;
    }
    .delete-product:hover {
      transform: scale(1.1);
    }
    .quantity-container {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin: 1rem 0;
    }
    .quantity-container label {
      font-size: 14px;
      color: #666;
    }
    .quantity-container input {
      width: 70px;
      text-align: center;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      padding: 8px;
      font-size: 14px;
    }
    .shipping-info {
      color: #32BEA6;
      font-size: 14px;
      margin-top: 1rem;
      font-weight: bold;
    }
    /* نافذة إتمام الطلب (Order Modal) */
    #orderModal form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      padding: 1rem;
    }
    #orderModal label {
      font-size: 14px;
      font-weight: bold;
      color: #2A5C82;
    }
    #orderModal input {
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.3s ease;
    }
    #orderModal input:focus {
      border-color: #2A5C82;
      box-shadow: 0 0 8px rgba(42,92,130,0.1);
    }
    #orderModal button {
      padding: 12px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      transition: transform 0.2s ease;
    }
    #orderModal button[type="button"] {
      background: linear-gradient(135deg, #2A5C82, #1A4668);
      color: #fff;
    }
    #orderModal button.cancel {
      background: linear-gradient(135deg, #d63031, #c62828);
      margin-top: 0.5rem;
    }
    #orderModal button:hover {
      transform: translateY(-2px);
    }
    /* نافذة الرسالة المنبثقة (Custom Alert) */
    .msg-modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      align-items: center;
      justify-content: center;
    }
    .msg-modal-content {
      background: #fff;
      margin: auto;
      padding: 1.5rem;
      border-radius: 12px;
      width: 90%;
      max-width: 400px;
      position: relative;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      animation: fadeInDown 0.4s ease;
    }
    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .msg-close {
      position: absolute;
      top: 15px;
      right: 20px;
      font-size: 1.5rem;
      font-weight: bold;
      color: #333;
      cursor: pointer;
      transition: color 0.3s ease;
    }
    .msg-close:hover {
      color: #d63031;
    }
    #messageTitle {
      font-size: 1.2rem;
      color: var(--primary-color);
      margin-bottom: 0.5rem;
    }
    #messageBody {
      font-size: 0.95rem;
      color: #333;
      line-height: 1.5;
      margin-bottom: 20px;
    }
    #messageOkBtn {
      background: linear-gradient(135deg, #2A5C82, #1A4668);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 10px 20px;
      font-size: 1rem;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    #messageOkBtn:hover {
      transform: translateY(-2px);
    }
    /* نافذة تأكيد الحذف (Delete Modal) */
    #deleteModal {
      display: none;
      position: fixed;
      z-index: 2100;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      align-items: center;
      justify-content: center;
    }
    #deleteModal .msg-modal-content {
      background: #fff;
      padding: 1.5rem;
      border-radius: 12px;
      width: 90%;
      max-width: 350px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    #deleteModal input {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
    }
    #deleteModal button {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      background: linear-gradient(135deg, #2A5C82, #1A4668);
      color: #fff;
      cursor: pointer;
      margin-top: 10px;
      transition: transform 0.2s ease;
    }
    #deleteModal button:hover {
      transform: translateY(-2px);
    }
    /* ميديا كويري للهواتف */
    @media (max-width: 600px) {
      #productsList {
        grid-template-columns: repeat(2, 1fr);
      }
      .product-card {
        max-width: 100%;
      }
      .search-wrapper input {
        font-size: 14px;
      }
      #header h1 {
        font-size: 1.4rem;
      }
      .nav-icon {
        width: 24px;
        height: 24px;
      }
    }
  
    button {
        font-family: 'Tajawal', sans-serif;
        background: linear-gradient(135deg, #2A5C82, #1A4668);
        color: #fff;
        border: none;
        padding: 10px 18px;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    button:hover {
        background: linear-gradient(135deg, #1A4668, #2A5C82);
        transform: scale(1.05);
        box-shadow: 0 0 12px rgba(42,92,130,0.6);
    }
    #categoryButtons button {
        background: linear-gradient(135deg, #FF7E67, #FF4B2B);
        font-size: 14px;
        padding: 6px 14px;
        border-radius: 20px;
        color: white;
        transition: all 0.3s ease;
    }
    #categoryButtons button:hover {
        transform: scale(1.05);
        box-shadow: 0 0 10px rgba(255, 126, 103, 0.8);
    }
    </style>

<!-- Firebase SDK -->


<script>
  
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>
</head>
<body>
<!-- حذف قسم تسجيل الدخول بالكامل -->
<!-- الشاشة الرئيسية -->
<div id="mainScreen">
<!-- الهيدر -->
<div id="header">
<h1>متجر إلكتروني</h1>
<div id="favContainer">
<button id="favBtn" onclick="showFavoritesScreen()">
<svg class="nav-icon" style="fill:#fff;" viewbox="0 0 24 24">
<path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5                 2 5.42 4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09C13.09 3.81                 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55                 11.54L12 21.35z"></path>
</svg>
<span style="display:block;font-size:12px;margin-top:2px;">مفضلة</span>
</button>
</div>
<button id="cartBtn" onclick="showScreen('cartScreen')">
<svg class="nav-icon" style="fill:#fff;" viewbox="0 0 24 24">
<path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9               2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96               0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45               c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48               0-.55-.45-1-1-1H5.21l-.94-2H1z"></path>
</svg>
<span class="cart-badge" id="cartCounter">0</span>
<span style="display:block;font-size:12px;margin-top:2px;">السلة</span>
</button>
<button id="supportBtn" onclick="window.open('https://wa.me/201202687082', '_blank')">
<svg class="nav-icon" style="fill:#fff;" viewbox="0 0 24 24">
<path d="M12 2C6.48 2 2 6.48 2 12c0 1.85.5 3.58 1.39 5.07L2 22l5.17-1.36C8.42 21.5 10.15 22 12 22c5.52 0 10-4.48 10-10S17.52 2 12 2zm.02 17c-1.72 0-3.37-.5-4.79-1.45l-.34-.22-3.07.8.82-2.99-.22-.35A8.447 8.447 0 013.5 12c0-4.69 3.81-8.5 8.5-8.5S20.5 7.31 20.5 12s-3.81 8.5-8.48 8.5z"></path>
</svg>
<span style="display:block;font-size:12px;margin-top:2px;">الدعم</span>
</button>
</div>
<!-- منطقة المحتوى -->
<div id="content">
<!-- شريط البحث -->
<div id="searchContainer">
<div class="search-wrapper">
<input id="searchInput" oninput="renderProducts()" placeholder="ابحث عن منتج..." style="box-shadow: 0 2px 8px rgba(0,0,0,0.15); border: none; font-size: 16px;" type="text"/>
<svg class="search-icon" viewbox="0 0 24 24">
<path d="M15.5 14h-.79l-.28-.27a6.471 6.471 0 001.48-5.34C15.39 5.91 13.48 4 11 4S6.61 5.91 6.61 8.39 8.52 12.78 11 12.78c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l4.99 5L20.49 19l-5-5zM11 10a2 2 0 110-4 2 2 0 010 4z"></path>
</svg>
</div>
</div><div id="categoryButtons" style="display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin:10px 0;"><button style="background: linear-gradient(135deg, #6c757d, #495057); color: white; padding: 6px 14px; border: none; border-radius: 20px; cursor: pointer;">الكل</button><button style="background:#2A5C82;color:white;padding:8px 16px;border:none;border-radius:20px;cursor:pointer;">إلكترونيات</button><button style="background:#2A5C82;color:white;padding:8px 16px;border:none;border-radius:20px;cursor:pointer;">ملابس</button><button style="background:#2A5C82;color:white;padding:8px 16px;border:none;border-radius:20px;cursor:pointer;">أثاث</button><button style="background:#2A5C82;color:white;padding:8px 16px;border:none;border-radius:20px;cursor:pointer;">أخرى</button></div>
<!-- شريط التمرير الأفقي (Slider) يعرض 6 منتجات -->
<div class="horizontal-slider" id="horizontalSlider"></div>
<!-- شاشة المنتجات (Grid) -->
<div class="screen active" id="homeScreen">
<h2 style="text-align:center; margin-bottom:10px;">المنتجات</h2>
<div id="productsList">
<p style="text-align:center;">لا توجد منتجات حتى الآن</p>
</div>
</div>
<!-- شاشة رفع المنتجات -->
<div class="screen" id="uploadScreen">
<h2 style="text-align:center; margin-bottom:10px;">رفع منتج جديد</h2>
<div class="upload-form">
<select id="uploadCategory">
<option value="">اختر الفئة</option>
<option value="إلكترونيات">إلكترونيات</option>
<option value="ملابس">ملابس</option>
<option value="أثاث">أثاث</option>
<option value="أخرى">أخرى</option>
</select>
<input id="uploadProductName" placeholder="اسم المنتج" type="text"/>
<textarea id="uploadDescription" placeholder="وصف المنتج"></textarea>
<input id="uploadPrice" min="0" placeholder="السعر بالجنيه" type="number"/>
<input id="uploadDiscount" max="100" min="0" placeholder="نسبة الخصم %" type="number"/>
<input id="uploadWhatsapp" placeholder="رقم الواتساب الخاص بالبائع (يبدأ بـ20)" type="text"/>
<input accept="image/*" id="uploadImages" multiple="" type="file"/>
<button onclick="uploadProduct()">رفع المنتج</button>
</div>
</div>
<!-- شاشة السلة -->
<div class="screen" id="cartScreen">
<h2 style="text-align:center; margin-bottom:10px;">السلة</h2>
<div id="cartList">
<p style="text-align:center;">السلة فارغة</p>
</div>
<button class="complete-purchase" id="completePurchaseBtn" onclick="completePurchase()" style="display:none;">
          إتمام عملية الشراء
        </button>
</div>
<!-- شاشة المفضلة -->
<div class="screen" id="favoriteScreen">
<h2 style="text-align:center; margin-bottom:10px;">المفضلة</h2>
<div id="favoriteList">
<p style="text-align:center;">لا توجد منتجات مفضلة</p>
</div>
</div>
<!-- شاشة الملف الشخصي -->
<div class="screen" id="profileScreen">
<h2 style="text-align:center; margin-bottom:10px;">الملف الشخصي</h2>
<div class="profile-info" style="background:#fff; padding:20px; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.08); text-align:center;">
<img alt="صورة الملف الشخصي" id="profileImage" src="" style="width:100px; height:100px; border-radius:50%; object-fit:cover; margin-bottom:1rem; display:none;"/>
<p><strong>الاسم:</strong> <span id="profileName"></span></p>
<p><strong>رقم الهاتف:</strong> <span id="profilePhone"></span></p>
<!-- تم إزالة زر تسجيل الخروج ونظام المستخدم -->
</div>
<input id="profileFullName" placeholder="الاسم الثلاثي" style="margin:10px 0;padding:10px;width:100%;border-radius:8px;border:2px solid #ccc;" type="text"/>
<input id="profilePhoneInput" placeholder="رقم الهاتف" style="margin:10px 0;padding:10px;width:100%;border-radius:8px;border:2px solid #ccc;" type="text"/>
<input id="profileProvince" placeholder="المحافظة" style="margin:10px 0;padding:10px;width:100%;border-radius:8px;border:2px solid #ccc;" type="text"/>
<input id="profileCity" placeholder="المدينة" style="margin:10px 0;padding:10px;width:100%;border-radius:8px;border:2px solid #ccc;" type="text"/>
<button onclick="saveProfileInfo()">حفظ البيانات</button>
</div>
</div>
</div>
<!-- شريط التنقل السفلي -->
<div id="bottomNav">
<button class="active" id="btnHome" onclick="showScreen('homeScreen')">
<svg class="nav-icon" viewbox="0 0 24 24">
<path d="M12 2L2 12h3v8h6v-6h2v6h6v-8h3L12 2z"></path>
</svg>
<span>الرئيسية</span>
</button>
<button id="btnUpload" onclick="showScreen('uploadScreen')">
<svg class="nav-icon" viewbox="0 0 24 24">
<path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"></path>
</svg>
<span>رفع منتج</span>
</button>
<button id="btnCart" onclick="showScreen('cartScreen')">
<svg class="nav-icon" viewbox="0 0 24 24">
<path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"></path>
</svg>
<span>السلة</span>
<span class="cart-badge" id="cartCounter">0</span>
</button>
<button id="btnProfile" onclick="showScreen('profileScreen')">
<svg class="nav-icon" viewbox="0 0 24 24">
<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"></path>
</svg>
<span>الملف</span>
</button>
</div>
<!-- نافذة تفاصيل المنتج (Modal) -->
<div class="modal" id="productDetailModal" onclick="closeProductModal(event)">
<div class="modal-content" onclick="event.stopPropagation()">
<span class="close" onclick="closeProductModal(event)">×</span>
<div class="slider-container">
<div class="slider-images" id="detailSliderImages"></div>
<button class="slider-arrow left" onclick="prevSlide()">❮</button>
<button class="slider-arrow right" onclick="nextSlide()">❯</button>
</div>
<div class="modal-details">
<h3 id="detailName"></h3>
<div class="price-row">
<span class="discount-badge" id="detailDiscountBadge" style="display:none;"></span>
<span class="old-price" id="detailOldPrice" style="display:none;"></span>
<span class="new-price" id="detailNewPrice"></span>
</div>
<div id="detailDescription"></div>
<p><strong>الفئة:</strong> <span id="detailCategory"></span></p>
<p><strong>واتساب:</strong> <span id="detailWhatsapp"></span></p>
<div class="shipping-info">سيصلك خلال 5 أيام عمل تقريبًا</div>
<div class="ramadan-offer" id="detailOfferLabel" style="display:none;">عرض رمضان</div>
<div class="quantity-container" style="margin-top:10px;">
<label for="detailQuantity">الكمية:</label>
<input id="detailQuantity" min="1" type="number" value="1"/>
</div>
<div class="modal-actions">
<button class="add-to-cart" onclick="addToCart(detailIndex)">أضف للعربة</button>
<button class="buy-now" onclick="buyNow(detailIndex)">شراء الآن</button>
<!-- أيقونة حذف المنتج (×) تحت المنتج -->
<button class="delete-product" onclick="showDeleteModal(detailIndex)">×</button>
</div>
</div>
</div>
</div>
<!-- نافذة تأكيد الحذف (Delete Modal) -->
<div class="msg-modal" id="deleteModal" onclick="closeDeleteModal(event)">
<div class="msg-modal-content" onclick="event.stopPropagation()">
<span class="msg-close" onclick="closeDeleteModal(event)">×</span>
<h3 style="margin-bottom:10px;">تأكيد الحذف</h3>
<p style="margin-bottom:10px;">من فضلك ادخل رمز الحذف</p>
<input id="deleteCodeInput" placeholder="أدخل رمز الحذف" style="width:100%; padding:10px; margin-bottom:10px; border:2px solid #e0e0e0; border-radius:8px;" type="password"/>
<button id="deleteConfirmBtn" onclick="confirmDelete()">حذف</button>
<button id="deleteCancelBtn" onclick="closeDeleteModal(event)" style="background: #ccc; margin-top:10px;">إلغاء</button>
</div>
</div>
<!-- نافذة إتمام الطلب (Order Modal) -->
<div class="modal" id="orderModal" onclick="closeOrderModal(event)">
<div class="modal-content" onclick="event.stopPropagation()">
<span class="close" onclick="closeOrderModal(event)">×</span>
<h3>إتمام عملية الشراء</h3>
<form id="orderForm">
<label>الاسم الثلاثي:</label>
<input id="orderFullName" placeholder="اكتب اسمك الثلاثي" required="" type="text"/>
<label>رقم التليفون:</label>
<input id="orderPhone" placeholder="اكتب رقم التليفون" required="" type="text"/>
<label>المحافظة:</label>
<input id="orderProvince" placeholder="اكتب المحافظة" required="" type="text"/>
<label>المدينة:</label>
<input id="orderCity" placeholder="اكتب المدينة" required="" type="text"/>
<label>اسم المنتج:</label>
<input id="orderProduct" placeholder="سيتم إدخال المنتجات تلقائيًا" readonly="" type="text"/>
<button onclick="sendOrder()" type="button">إرسال</button>
<button class="cancel" onclick="closeOrderModal(event)" type="button">إلغاء</button>
</form>
</div>
</div>
<!-- نافذة الرسالة المنبثقة (Custom Alert) -->
<div class="msg-modal" id="messageModal" onclick="closeMessageModal(event)">
<div class="msg-modal-content" onclick="event.stopPropagation()">
<span class="msg-close" onclick="closeMessageModal(event)">×</span>
<h3 id="messageTitle" style="margin-bottom:10px;"></h3>
<p id="messageBody" style="margin-bottom:20px;"></p>
<button id="messageOkBtn" onclick="closeMessageModal(event)">موافق</button>
</div>
</div>
<!-- قسم الشريط الأفقي (Slider) يعرض 6 منتجات -->
<div class="horizontal-slider" id="horizontalSlider"></div>
<script>
    let products = [];
    let cartItems = [];
    let detailIndex = null;
    let currentSlide = 0;
    let sliderImages = [];
    let sliderIndex = 0; // مؤشر الشريحة في الشريط الأفقي
    let deleteIndex = null; // لحفظ رقم المنتج الذي سيُحذف

    // دوال الرسالة المنبثقة
    function showMessage(title, text) {
      document.getElementById("messageTitle").textContent = title;
      document.getElementById("messageBody").textContent = text;
      document.getElementById("messageModal").style.display = "flex";
    }
    function closeMessageModal(event) {
      document.getElementById("messageModal").style.display = "none";
    }
    // دالة تنسيق رقم الواتساب بحيث يبدأ بـ "20"
    function formatWhatsappNumber(num) {
      num = num.replace(/\D/g, '');
      if (!num.startsWith("20")) {
        num = "20" + num;
      }
      return num;
    }
    // تحميل البيانات من localStorage (تم الاحتفاظ ببيانات المنتجات والسلة)
    function loadData() {
      const savedProducts = localStorage.getItem("products");
      if (savedProducts) {
        products = JSON.parse(savedProducts);
        renderProducts();
        renderSlider();
      }
      const savedCartItems = localStorage.getItem("cartItems");
      if (savedCartItems) {
        cartItems = JSON.parse(savedCartItems);
        renderCart();
      }
    }
    function saveData() {
      localStorage.setItem("products", JSON.stringify(products));
      localStorage.setItem("cartItems", JSON.stringify(cartItems));
    }
    function showScreen(screenId) {
      document.querySelectorAll(".screen").forEach(screen => {
        screen.classList.remove("active");
      });
      document.getElementById(screenId).classList.add("active");
      document.querySelectorAll("#bottomNav button").forEach(btn => {
        btn.classList.remove("active");
      });
      if (screenId === "homeScreen") {
        document.getElementById("btnHome").classList.add("active");
      } else if (screenId === "uploadScreen") {
        document.getElementById("btnUpload").classList.add("active");
      } else if (screenId === "cartScreen") {
        document.getElementById("btnCart").classList.add("active");
        renderCart();
      } else if (screenId === "profileScreen") {
        document.getElementById("btnProfile").classList.add("active");
      } else if (screenId === "favoriteScreen") {
        renderFavorites();
      }
    }
    function showFavoritesScreen() {
      showScreen("favoriteScreen");
      renderFavorites();
    }
    function renderProducts() {
      const productsList = document.getElementById("productsList");
      if (products.length === 0) {
        productsList.innerHTML = '<p style="text-align:center;">لا توجد منتجات حتى الآن</p>';
        return;
      }
      const query = document.getElementById("searchInput")?.value.trim().toLowerCase() || "";
      let filteredProducts = products;
      if (query !== "") {
        filteredProducts = products.filter(p => p.name.toLowerCase().includes(query));
      }
      if (filteredProducts.length === 0) {
        productsList.innerHTML = '<p style="text-align:center;">لا توجد منتجات مطابقة</p>';
        return;
      }
      let html = "";
      filteredProducts.forEach((product, index) => {
        let finalPrice = product.price;
        let discountLabel = "";
        let oldPriceHTML = "";
        if (product.discount > 0) {
          finalPrice = product.price - (product.price * (product.discount / 100));
          discountLabel = `<span class="discount-badge">${product.discount}% خصم</span>`;
          oldPriceHTML = `<span class="old-price">${product.price.toFixed(2)} ج.م</span>`;
        }
        const heartIcon = product.favorite ? "♥" : "♡";
        html += `
          <div class="product-card" onclick="openProductDetails(${index})">
            <button class="favorite-btn ${product.favorite ? "active" : ""}" onclick="toggleFavorite(${index}, event)">
              ${heartIcon}
            </button>
            <img src="${product.images && product.images[0] ? product.images[0] : ""}" alt="${product.name}">
            <div class="product-info">
              <h3>${product.name}</h3>
              ${discountLabel}
              ${oldPriceHTML}
              <span class="new-price">${finalPrice.toFixed(2)} ج.م</span>
            </div>
          </div>
        `;
      });
      productsList.innerHTML = html;
      saveData();
      renderSlider();
    }
    function toggleFavorite(index, event) {
      event.stopPropagation();
      products[index].favorite = !products[index].favorite;
      renderProducts();
    }
    function renderFavorites() {
      const favoriteList = document.getElementById("favoriteList");
      const favoriteItems = products.filter(p => p.favorite);
      if (favoriteItems.length === 0) {
        favoriteList.innerHTML = '<p style="text-align:center;">لا توجد منتجات مفضلة</p>';
        return;
      }
      let html = "";
      favoriteItems.forEach(item => {
        let finalPrice = item.price;
        let discountLabel = "";
        let oldPriceHTML = "";
        if (item.discount > 0) {
          finalPrice = item.price - (item.price * (item.discount / 100));
          discountLabel = `<span class="discount-badge">${item.discount}% خصم</span>`;
          oldPriceHTML = `<span class="old-price">${item.price.toFixed(2)} ج.م</span>`;
        }
        html += `
          <div class="favorite-card" onclick="openProductDetails(${products.indexOf(item)})">
            <img src="${item.images && item.images[0] ? item.images[0] : ""}" alt="${item.name}">
            <div class="product-info" style="margin-top:8px;">
              <h3>${item.name}</h3>
              ${discountLabel}
              ${oldPriceHTML}
              <span class="new-price">${finalPrice.toFixed(2)} ج.م</span>
            </div>
            <button onclick="removeFromFavorites('${item.name}', event)" style="position:absolute; top:5px; left:5px; background:none; border:none; cursor:pointer; color:#ff0000; font-size:24px;">♥</button>
          </div>
        `;
      });
      favoriteList.innerHTML = html;
    }
    function removeFromFavorites(productName, event) {
      if(event) event.stopPropagation();
      const product = products.find(p => p.name === productName);
      if (product) product.favorite = false;
      renderFavorites();
      renderProducts();
    }
    function renderCart() {
      const cartList = document.getElementById("cartList");
      if (cartItems.length === 0) {
        cartList.innerHTML = '<p style="text-align:center;">السلة فارغة</p>';
        document.getElementById("completePurchaseBtn").style.display = "none";
        return;
      }
      let html = "";
      cartItems.forEach((item, index) => {
        let finalPrice = item.price;
        if (item.discount > 0) {
          finalPrice = item.price - (item.price * (item.discount / 100));
        }
        let totalItemPrice = finalPrice * (item.selectedQuantity || 1);
        html += `
          <div class="cart-card" onclick="openProductDetails(${products.indexOf(item)})">
            <img src="${item.images && item.images[0] ? item.images[0] : ""}" alt="${item.name}">
            <div style="margin-top:1rem;">
              <h3 style="font-size:14px; margin-bottom:0.5rem;">${item.name}</h3>
              <p>الكمية: ${item.selectedQuantity || 1}</p>
              <p>السعر الإجمالي: ${totalItemPrice.toFixed(2)} ج.م</p>
              <button onclick="removeFromCart(${index}, event)" style="padding:5px 10px; border:none; background:#d63031; color:#fff; border-radius:5px; cursor:pointer;">حذف</button>
            </div>
          </div>
        `;
      });
      cartList.innerHTML = html;
      document.getElementById("completePurchaseBtn").style.display = "block";
      updateCartBadge();
    }
    function removeFromCart(index, event) {
      if(event) event.stopPropagation();
      cartItems.splice(index, 1);
      renderCart();
      updateCartBadge();
    }
    function openProductDetails(index) {
      detailIndex = index;
      const product = products[index];
      sliderImages = product.images || [];
      currentSlide = 0;
      renderSliderImages();
      document.getElementById("detailName").textContent = product.name;
      document.getElementById("detailDescription").textContent = product.description || "";
      document.getElementById("detailCategory").textContent = product.category;
      document.getElementById("detailWhatsapp").textContent = product.whatsapp;
      document.getElementById("detailQuantity").value = 1;
      let finalPrice = product.price;
      if (product.discount > 0) {
        finalPrice = product.price - (product.price * (product.discount / 100));
        document.getElementById("detailDiscountBadge").style.display = "inline-block";
        document.getElementById("detailDiscountBadge").textContent = product.discount + "% خصم";
        document.getElementById("detailOldPrice").style.display = "inline-block";
        document.getElementById("detailOldPrice").textContent = product.price.toFixed(2) + " ج.م";
        document.getElementById("detailOfferLabel").style.display = "block";
      } else {
        document.getElementById("detailDiscountBadge").style.display = "none";
        document.getElementById("detailOldPrice").style.display = "none";
        document.getElementById("detailOfferLabel").style.display = "none";
      }
      document.getElementById("detailNewPrice").textContent = finalPrice.toFixed(2) + " ج.م";
      document.getElementById("productDetailModal").style.display = "flex";
    }
    function closeProductModal(event) {
      document.getElementById("productDetailModal").style.display = "none";
    }
    function renderSliderImages() {
      const sliderContainer = document.getElementById("detailSliderImages");
      sliderContainer.innerHTML = "";
      sliderImages.forEach((imgSrc, i) => {
        const imgEl = document.createElement("img");
        imgEl.src = imgSrc;
        if (i === currentSlide) imgEl.classList.add("active");
        sliderContainer.appendChild(imgEl);
      });
    }
    function nextSlide() {
      if (sliderImages.length === 0) return;
      currentSlide = (currentSlide + 1) % sliderImages.length;
      renderSliderImages();
    }
    function prevSlide() {
      if (sliderImages.length === 0) return;
      currentSlide = (sliderImages.length + currentSlide - 1) % sliderImages.length;
      renderSliderImages();
    }
    function addToCart(index) {
      const product = products[index];
      const quantity = parseInt(document.getElementById("detailQuantity").value) || 1;
      cartItems.push({ ...product, selectedQuantity: quantity });
      showMessage("تمت الإضافة", `تم إضافة المنتج "${product.name}" بعدد ${quantity} إلى السلة بنجاح!`);
      closeProductModal();
      renderCart();
      updateCartBadge();
    }
    function buyNow(index) {
      const product = products[index];
      const quantity = parseInt(document.getElementById("detailQuantity").value) || 1;
      cartItems = [{ ...product, selectedQuantity: quantity }];
      closeProductModal();
      completePurchase();
    }
    // دالة حذف المنتج باستخدام نافذة تأكيد الحذف
    function showDeleteModal(index) {
      deleteIndex = index;
      document.getElementById("deleteCodeInput").value = "";
      document.getElementById("deleteModal").style.display = "flex";
    }
    function closeDeleteModal(event) {
      document.getElementById("deleteModal").style.display = "none";
    }
    function confirmDelete() {
      const code = document.getElementById("deleteCodeInput").value.trim();
      if (code === "saif123") {
        products.splice(deleteIndex, 1);
        saveData();
        renderProducts();
        closeDeleteModal();
        closeProductModal();
        showMessage("نجاح", "تم حذف المنتج بنجاح!");
      } else {
        showMessage("تنبيه", "رمز الحذف غير صحيح");
      }
    }
    function completePurchase() {
      if (cartItems.length === 0) {
        showMessage("تنبيه", "السلة فارغة");
        return;
      }
      const productNames = cartItems.map(item => item.name).join(", ");
      document.getElementById("orderProduct").value = productNames;
      document.getElementById("orderModal").style.display = "flex";
      loadProfileInfo();
      updateCartBadge();
    }
    function closeOrderModal(event) {
      document.getElementById("orderModal").style.display = "none";
    }
    function sendOrder() {
      const fullName = document.getElementById("orderFullName").value.trim();
      const phone = document.getElementById("orderPhone").value.trim();
      const province = document.getElementById("orderProvince").value.trim();
      const city = document.getElementById("orderCity").value.trim();
      const product = document.getElementById("orderProduct").value.trim();
      if (!fullName || !phone || !province || !city) {
        showMessage("تنبيه", "يرجى ملء جميع البيانات المطلوبة");
        return;
      }
      const message = `طلب شراء:\nالاسم: ${fullName}\nرقم التليفون: ${phone}\nالمحافظة: ${province}\nالمدينة: ${city}\nالمنتج: ${product}`;
      const defaultWhatsApp = "201202687082";
      const rawWhatsapp = cartItems.length > 0 && cartItems[0].whatsapp ? cartItems[0].whatsapp : defaultWhatsApp;
      const whatsappNumber = formatWhatsappNumber(rawWhatsapp);
      window.open("https://wa.me/" + whatsappNumber + "?text=" + encodeURIComponent(message), "_blank");
      document.getElementById("orderModal").style.display = "none";
      cartItems = [];
      renderCart();
      saveData();
      showMessage("نجاح", "تم إرسال طلبك عبر الواتساب بنجاح!");
    }
    function updateCartBadge() {
      const totalItems = cartItems.reduce((sum, item) => sum + (item.selectedQuantity || 1), 0);
      document.getElementById('cartCounter').textContent = totalItems;
    }
    async function uploadProduct() {
      const category = document.getElementById("uploadCategory").value.trim();
      const productName = document.getElementById("uploadProductName").value.trim();
      const description = document.getElementById("uploadDescription").value.trim();
      const priceValue = parseFloat(document.getElementById("uploadPrice").value) || 0;
      const discountValue = parseFloat(document.getElementById("uploadDiscount").value) || 0;
      const whatsapp = document.getElementById("uploadWhatsapp").value.trim();
      const imageFiles = document.getElementById("uploadImages").files;
      if (!category || !productName || !description || !whatsapp || imageFiles.length === 0 || priceValue <= 0) {
        showMessage("تنبيه", "يرجى إدخال جميع البيانات المطلوبة بشكل صحيح");
        return;
      }
      if (imageFiles.length > 3) {
        showMessage("تنبيه", "يمكنك اختيار حتى 3 صور فقط");
        return;
      }
      if (discountValue < 0 || discountValue > 100) {
        showMessage("تنبيه", "نسبة الخصم يجب أن تكون بين 0 و 100");
        return;
      }
      let imagesData = [];
      for (let i = 0; i < imageFiles.length; i++) {
        try {
          const dataURL = await fileToDataURL(imageFiles[i]);
          imagesData.push(dataURL);
        } catch (e) {
          console.error("Error reading file", e);
        }
      }
      const product = {
        category,
        name: productName,
        description,
        price: priceValue,
        discount: discountValue,
        whatsapp,
        images: imagesData,
        favorite: false,
        createdAt: new Date()
      };
      products.push(product);
      renderProducts();
      showMessage("تم الرفع", "تم رفع المنتج بنجاح");
      document.getElementById("uploadCategory").value = "";
      document.getElementById("uploadProductName").value = "";
      document.getElementById("uploadDescription").value = "";
      document.getElementById("uploadPrice").value = "";
      document.getElementById("uploadDiscount").value = "";
      document.getElementById("uploadWhatsapp").value = "";
      document.getElementById("uploadImages").value = "";
      showScreen("homeScreen");
      saveData();
    }
    let lastScroll = 0;
    window.addEventListener('scroll', () => {
      const currentScroll = window.pageYOffset;
      const header = document.getElementById('header');
      if (currentScroll > lastScroll && currentScroll > 100) {
        header.style.transform = 'translateY(-100%)';
      } else {
        header.style.transform = 'translateY(0)';
      }
      lastScroll = currentScroll;
    });
    document.querySelectorAll('#bottomNav button').forEach(btn => {
      btn.addEventListener('click', function() {
        this.style.transform = 'scale(0.95)';
        setTimeout(() => { this.style.transform = ''; }, 200);
      });
    });
    function uploadProfilePic(event) {
      const file = event.target.files[0];
      if (!file) return;
      fileToDataURL(file).then(dataURL => {
        // في هذا المثال قمنا بحذف نظام المستخدم، لذا لم يعد هناك حفظ لصورة الملف الشخصي
        document.getElementById("profileImage").src = dataURL;
        document.getElementById("profileImage").style.display = "block";
      }).catch(err => {
        console.error("Error uploading profile picture:", err);
      });
    }
    function fileToDataURL(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
        reader.readAsDataURL(file);
      });
    }
    window.onload = loadData;
  
    function completePurchase() {
      if (cartItems.length === 0) {
        showMessage("تنبيه", "السلة فارغة");
        return;
      }
      let lines = cartItems.map(item => `- ${item.name} × ${item.selectedQuantity || 1}`);
      document.getElementById("orderProduct").value = lines.join("\n");
      document.getElementById("orderModal").style.display = "flex";
      loadProfileInfo();
      updateCartBadge();
    }
    
    document.querySelectorAll('#categoryButtons button').forEach(btn => {
      btn.addEventListener('click', () => {
        const category = btn.innerText.trim();
        const filtered = products.filter(p => p.category === category);
        const productsList = document.getElementById("productsList");
        if (filtered.length === 0) {
          productsList.innerHTML = '<p style="text-align:center;">لا توجد منتجات في هذه الفئة</p>';
          return;
        }
        let html = "";
        filtered.forEach((product, index) => {
          let finalPrice = product.price;
          let discountLabel = "";
          let oldPriceHTML = "";
          if (product.discount > 0) {
            finalPrice = product.price - (product.price * (product.discount / 100));
            discountLabel = `<span class="discount-badge">${product.discount}% خصم</span>`;
            oldPriceHTML = `<span class="old-price">${product.price.toFixed(2)} ج.م</span>`;
          }
          const heartIcon = product.favorite ? "♥" : "♡";
          html += `
            <div class="product-card" onclick="openProductDetails(${index})">
              <button class="favorite-btn ${product.favorite ? "active" : ""}" onclick="toggleFavorite(${index}, event)">
                ${heartIcon}
              </button>
              <img src="${product.images && product.images[0] ? product.images[0] : ""}" alt="${product.name}">
              <div class="product-info">
                <h3>${product.name}</h3>
                ${discountLabel}
                ${oldPriceHTML}
                <span class="new-price">${finalPrice.toFixed(2)} ج.م</span>
              </div>
            </div>
          `;
        });
        productsList.innerHTML = html;
      });
    });

  function saveProfileInfo() {
    const name = document.getElementById("profileFullName").value.trim();
    const phone = document.getElementById("profilePhoneInput").value.trim();
    const province = document.getElementById("profileProvince").value.trim();
    const city = document.getElementById("profileCity").value.trim();
    localStorage.setItem("profileInfo", JSON.stringify({ name, phone, province, city }));
    showMessage("تم الحفظ", "تم حفظ بيانات الملف الشخصي بنجاح.");
  }

  function loadProfileInfo() {
    const data = JSON.parse(localStorage.getItem("profileInfo") || "{}");
    if (data.name) document.getElementById("profileFullName").value = data.name;
    if (data.phone) document.getElementById("profilePhoneInput").value = data.phone;
    if (data.province) document.getElementById("profileProvince").value = data.province;
    if (data.city) document.getElementById("profileCity").value = data.city;

    // لملء نموذج الطلب عند الشراء
    if (document.getElementById("orderFullName")) document.getElementById("orderFullName").value = data.name || "";
    if (document.getElementById("orderPhone")) document.getElementById("orderPhone").value = data.phone || "";
    if (document.getElementById("orderProvince")) document.getElementById("orderProvince").value = data.province || "";
    if (document.getElementById("orderCity")) document.getElementById("orderCity").value = data.city || "";
  }

  window.onload = function() {
    loadData();
    loadProfileInfo();
  }

    // عرض كل المنتجات عند الضغط على "الكل"
    document.querySelectorAll('#categoryButtons button').forEach(btn => {
      if (btn.innerText.trim() === "الكل") {
        btn.addEventListener('click', () => {
          renderProducts();
        });
      }
    });
    </script>


</body>
</html>